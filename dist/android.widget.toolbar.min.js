this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const{NODE_PROCEDURE:e,NODE_RESOURCE:t}=squared.base.lib.constant,{CONTAINER_TAGNAME:a,CONTAINER_NODE:o,SUPPORT_TAGNAME:r,SUPPORT_TAGNAME_X:n}=android.lib.constant,{formatPX:d}=squared.lib.css,{getElementAsNode:i}=squared.lib.session,{assignEmptyValue:s,capitalize:l,iterateArray:c}=squared.lib.util,{createThemeAttribute:p,createViewAttribute:u,getDocumentId:m}=android.lib.util,h=android.base.Resource,g="ic_menu_";class Toolbar extends squared.base.ExtensionUI{constructor(e,t,a){super(e,t,a),this.require({name:"android.widget.menu"})}beforeInsertNode(e,t){if(this.included(e)){const a=this.application;c(e.children,(e=>{if("NAV"===e.tagName){const t=a.getDatasetName("use",e);if(!Toolbar.includes(t,"android.external"))return a.setDatasetName("use",e,(t?t+", ":"")+"android.external"),!0}}));const o=e.dataset.androidTarget;if(o){const r=document.getElementById(o);if(r&&!Toolbar.includes(a.getDatasetName("use",r),"android.widget.coordinator")){const o=a.getProcessing(t).rootElements;o.includes(e)||o.push(e)}}}return!1}processNode(e,t){const o=this.application,l=this.resource,p=e.localSettings.resourceId,b=o.userSettings,y=e.element,T=Object.assign({},this.options[y.id.trim()]),f=u(T.self),A=u(T.appBar),O=u(T.collapsingToolbar),I=o.extensionManager.valueAsBoolean("android.resource.strings","numberAsResource"),N=Toolbar.findNestedElement(e,"android.widget.menu"),w=e.has("backgroundImage"),_=[],P=[];let v=f.app||(f.app={});c(y.children,(t=>{const a=t.dataset;if("IMG"===t.tagName){if(a.navigationIcon){const e=l.addImageSrc(p,t,g);e&&s(v,"navigationIcon",`@drawable/${e}`)}if(a.collapseIcon){const e=l.addImageSrc(p,t,g);e&&s(v,"collapseIcon",`@drawable/${e}`)}}if(!a.androidTarget){const o=i(t,e.sessionId);if(o)switch(a.androidTargetModule){case"appBar":_.push(o);break;case"collapsingToolbar":P.push(o)}}}));const B="collapsingToolbar"in T||P.length>0,E="appBar"in T||_.length>0||B;let S="",C="",k,L,R,x,D,M;if(e.api<29?(x=r.TOOLBAR,D=r.APPBAR,M=r.COLLAPSING_TOOLBAR):(x=n.TOOLBAR,D=n.APPBAR,M=n.COLLAPSING_TOOLBAR),B?s(v,"layout_collapseMode","pin"):(s(v,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),w||s(v,"layout_scrollFlags","scroll|enterAlways")),E){if(N){const e=v.popupTheme;e&&(C=e.replace("@style/","")),v.popupTheme=`@style/${b.manifestThemeName}.PopupOverlay`}}else e.exclude({procedure:2}),s(f,"android","fitsSystemWindows","true");if(s(f,"android","layout_height",E||!e.hasPX("height")?"?android:attr/actionBarSize":""),e.setControlType(x,14),e.exclude({resource:4}),E){let a=A.android;s(A,"android","id",`@+id/${e.controlId}_appbar`),s(A,"android","layout_height",e.hasHeight?d(e.actualHeight):"wrap_content"),s(A,"android","fitsSystemWindows","true"),N?(a.theme&&(S=a.theme),a.theme=`@style/${b.manifestThemeName}.AppBarOverlay`,e.data("android.widget.toolbar","themeData",{appBarOverlay:S,popupOverlay:C})):s(A,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),k=this.createPlaceholder(e,_,e.target),k.parent=t,a.id&&(k.controlId=m(a.id),delete a.id),k.setControlType(D,14),B&&(v=O.app||(O.app={}),s(O,"android","id",`@+id/${e.controlId}_collapsingtoolbar`),s(O,"android","fitsSystemWindows","true"),w||s(v,"contentScrim","?attr/colorPrimary"),s(v,"layout_scrollFlags","scroll|exitUntilCollapsed"),s(v,"toolbarId",e.documentId),L=this.createPlaceholder(e,P),L&&(L.parent=k,a=O.android,a.id&&(k.controlId=m(a.id),delete a.id),L.setControlType(M,14)))}if(k){if(k.setLayoutWidth("match_parent"),k.setLayoutHeight("wrap_content"),k.apply(h.formatOptions(p,A,I)),k.render(t),R={type:1,node:k,controlName:D},L){if(e.parent=L,L.apply(h.formatOptions(p,O,I)),L.render(k),L.setLayoutWidth("match_parent"),L.setLayoutHeight("match_parent"),o.addLayoutTemplate(L.renderParent,L,{type:1,node:L,controlName:M}),w){const t=l.addImageSrc(p,e.backgroundImage);if(t){const o=this.controller,r=u(T.backgroundImage);let n;switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":n="centerCrop";break;case"contain":case"100%":case"100% 100%":n="fitXY";break;case"auto":n="matrix";break;default:n="center"}v=r.app||(r.app={}),s(r,"android","id",`@+id/${e.controlId}_image`),s(r,"android","src",`@drawable/${t}`),s(r,"android","scaleType",n),s(r,"android","fitsSystemWindows","true"),s(v,"layout_collapseMode","parallax"),o.addBeforeOutsideTemplate(e,o.renderNodeStatic({controlName:a.IMAGE,width:"match_parent",height:"match_parent"},h.formatOptions(p,r,I))),e.setCacheValue("backgroundImage","")}}}else e.parent=k,w&&e.data("android.widget.toolbar","background",k);e.data("android.widget.toolbar","outerParent",k.android("id")||k.documentId),e.render(e.parent)}else e.render(t);e.setLayoutWidth("match_parent"),e.apply(h.formatOptions(p,f,I));const $={type:1,node:e,controlName:x};return k?{output:$,outerParent:e.parent,renderAs:k,outputAs:R,include:!0}:{output:$,include:!0}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(e){var t,a;const o=null===(t=Toolbar.findNestedElement(e,"android.widget.menu"))||void 0===t?void 0:t.dataset["layoutName"+l(this.application.systemName)];if(o){const t=u(null===(a=this.options[e.elementId])||void 0===a?void 0:a.self),r=t.app||(t.app={});s(r,"menu",`@menu/${o}`),e.app("menu",r.menu)}const r=e.data("android.widget.toolbar","themeData");if(r){const t=e.localSettings.resourceId,a=p(this.options.resource),o=p({name:".NoActionBar",output:a.output}),n=p({name:".AppBarOverlay",output:a.output}),d=p({name:".PopupOverlay",output:a.output});s(a,"name",this.application.userSettings.manifestThemeName),s(a,"parent","Theme.AppCompat.Light.DarkActionBar"),s(o.items,"windowActionBar","false"),s(o.items,"windowNoTitle","true"),s(n,"parent",r.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),s(d,"parent",r.popupOverlay||"ThemeOverlay.AppCompat.Light"),h.addTheme(t,a),h.addTheme(t,o),h.addTheme(t,n),h.addTheme(t,d)}const n=e.data("android.widget.toolbar","background");if(n){const t=e.android("background");t&&(n.android("background",t),e.delete("android","background"))}}createPlaceholder(e,t,a){const o=this.application.createNode(e.sessionId,{parent:e,children:t,flags:4|(t.length>0?2:0)});return o.inherit(e,"base"),a&&(o.dataset.androidTarget=a.id,o.innerWrapped=e),o.exclude({resource:31}),o.positioned=!0,o.renderExclude=!1,o}}const b=new Toolbar("android.widget.toolbar",2);return squared&&squared.add(b),b}();
