this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";const e=android.base.Resource,{NODE_PROCEDURE:t,NODE_RESOURCE:a}=squared.base.lib.constant,{CONTAINER_TAGNAME:o,CONTAINER_NODE:r,SUPPORT_TAGNAME:n,SUPPORT_TAGNAME_X:i}=android.lib.constant,{formatPX:d}=squared.lib.css,{getElementAsNode:s}=squared.lib.session,{capitalize:l,iterateArray:c}=squared.lib.util,{createThemeAttribute:p,createViewAttribute:u,createViewOptions:m,getDocumentId:h,removeFileExtension:g}=android.lib.util,{assignEmptyValue:b}=squared.base.lib.util,y="ic_menu_";class Toolbar extends squared.base.ExtensionUI{constructor(e,t,a){super(e,t,a),this.require({name:"android.widget.menu"})}beforeInsertNode(e,t){if(this.included(e)){const a=this.application;c(e.children,(e=>{if("NAV"===e.tagName){const t=a.getDatasetName("use",e);if(!Toolbar.includes(t,"android.external"))return a.setDatasetName("use",e,(t?t+", ":"")+"android.external"),!0}}));const o=e.dataset.androidTarget;if(o){const r=document.getElementById(o);r&&!Toolbar.includes(a.getDatasetName("use",r),"android.widget.coordinator")&&a.addRootElement(t,e)}}return!1}processNode(t,a){var r;const l=this.application,p=this.resource,m=t.localSettings.resourceId,g=t.element,T=Object.assign({},null===(r=this.options.element)||void 0===r?void 0:r[t.elementId]),f=u(T.self),A=u(T.appBar),O=u(T.collapsingToolbar),I=l.extensionManager.valueAsBoolean("android.resource.strings","numberAsResource"),N=Toolbar.findNestedElement(t,"android.widget.menu"),w=t.has("backgroundImage"),_=[],v=[];let E=f.app||(f.app={});c(g.children,(e=>{const a=e.dataset;if("IMG"===e.tagName){if(a.navigationIcon){const t=p.addImageSrc(m,e,y);t&&b(E,"navigationIcon",`@drawable/${t}`)}if(a.collapseIcon){const t=p.addImageSrc(m,e,y);t&&b(E,"collapseIcon",`@drawable/${t}`)}}if(!a.androidTarget){const o=s(e,t.sessionId);if(o)switch(a.androidTargetModule){case"appBar":_.push(o);break;case"collapsingToolbar":v.push(o)}}}));const B="collapsingToolbar"in T||v.length>0,P="appBar"in T||_.length>0||B;let S="",C="",k,L,R,x,D,q;if(t.api<29?(x=n.TOOLBAR,D=n.APPBAR,q=n.COLLAPSING_TOOLBAR):(x=i.TOOLBAR,D=i.APPBAR,q=i.COLLAPSING_TOOLBAR),B?b(E,"layout_collapseMode","pin"):(b(E,"popupTheme","@style/ThemeOverlay.AppCompat.Light"),w||b(E,"layout_scrollFlags","scroll|enterAlways")),P){if(N){const e=E.popupTheme;e&&(C=e.replace("@style/","")),E.popupTheme=`@style/${l.userSettings.manifestThemeName}.PopupOverlay`}}else t.exclude({procedure:2}),b(f,"android","fitsSystemWindows","true");if(b(f,"android","layout_height",P||!t.hasUnit("height")?"?android:attr/actionBarSize":""),t.setControlType(x,14),t.exclude({resource:4}),P){let e=A.android;b(A,"android","id",`@+id/${t.controlId}_appbar`),b(A,"android","layout_height",t.hasHeight?d(t.actualHeight):"wrap_content"),b(A,"android","fitsSystemWindows","true"),N?(e.theme&&(S=e.theme),e.theme=`@style/${l.userSettings.manifestThemeName}.AppBarOverlay`,t.data("android.widget.toolbar","themeData",{appBarOverlay:S,popupOverlay:C})):b(A,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),k=this.createPlaceholder(t,_,t.target),k.parent=a,e.id&&(k.controlId=h(e.id),delete e.id),k.setControlType(D,14),B&&(E=O.app||(O.app={}),b(O,"android","id",`@+id/${t.controlId}_collapsingtoolbar`),b(O,"android","fitsSystemWindows","true"),w||b(E,"contentScrim","?attr/colorPrimary"),b(E,"layout_scrollFlags","scroll|exitUntilCollapsed"),b(E,"toolbarId",t.documentId),L=this.createPlaceholder(t,v),L&&(L.parent=k,e=O.android,e.id&&(k.controlId=h(e.id),delete e.id),L.setControlType(q,14)))}if(k){if(k.setLayoutWidth("match_parent"),k.setLayoutHeight("wrap_content"),k.apply(e.formatOptions(m,A,I)),k.render(a),R={type:1,node:k,controlName:D},L){if(t.parent=L,L.apply(e.formatOptions(m,O,I)),L.render(k),L.setLayoutWidth("match_parent"),L.setLayoutHeight("match_parent"),l.addLayoutTemplate(L.renderParent,L,{type:1,node:L,controlName:q}),w){const a=p.addImageSrc(m,t.backgroundImage);if(a){const r=this.controller,n=u(T.backgroundImage);let i;switch(t.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":i="centerCrop";break;case"contain":case"100%":case"100% 100%":i="fitXY";break;case"auto":i="matrix";break;default:i="center"}E=n.app||(n.app={}),b(n,"android","id",`@+id/${t.controlId}_image`),b(n,"android","src",`@drawable/${a}`),b(n,"android","scaleType",i),b(n,"android","fitsSystemWindows","true"),b(E,"layout_collapseMode","parallax"),r.addBeforeOutsideTemplate(t,r.renderNodeStatic(t.sessionId,{controlName:o.IMAGE,width:"match_parent",height:"match_parent"},e.formatOptions(m,n,I))),t.setCacheValue("backgroundImage","")}}}else t.parent=k,w&&t.data("android.widget.toolbar","background",k);t.data("android.widget.toolbar","outerParent",k.android("id")||k.documentId),t.render(t.parent)}else t.render(a);t.setLayoutWidth("match_parent"),t.apply(e.formatOptions(m,f,I));const M={type:1,node:t,controlName:x};return k?{output:M,outerParent:t.parent,renderAs:k,outputAs:R,include:!0}:{output:M,include:!0}}processChild(e){if(e.imageElement&&(e.dataset.navigationIcon||e.dataset.collapseIcon))return e.hide(),{next:!0}}postOptimize(t){var a;const o=null===(a=Toolbar.findNestedElement(t,"android.widget.menu"))||void 0===a?void 0:a.dataset["filename"+l(this.application.systemName)];if(o){const e=u(m(this.options,t.elementId).self),a=e.app||(e.app={});b(a,"menu",`@menu/${g(o)}`),t.app("menu",a.menu)}const r=t.data("android.widget.toolbar","themeData");if(r){const a=t.localSettings.resourceId,o=p(this.options.resource),n=o.output,i=p({name:".NoActionBar",output:n}),d=p({name:".AppBarOverlay",output:n}),s=p({name:".PopupOverlay",output:n});b(o,"name",this.application.userSettings.manifestThemeName),b(o,"parent","Theme.AppCompat.Light.DarkActionBar"),b(i.items,"windowActionBar","false"),b(i.items,"windowNoTitle","true"),b(d,"parent",r.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar"),b(s,"parent",r.popupOverlay||"ThemeOverlay.AppCompat.Light"),e.addTheme(a,o),e.addTheme(a,i),e.addTheme(a,d),e.addTheme(a,s)}const n=t.data("android.widget.toolbar","background");if(n){const e=t.android("background");e&&(n.android("background",e),t.delete("android","background"))}}createPlaceholder(e,t,a){const o=this.application.createNode(e.sessionId,{parent:e,children:t,flags:4|(t.length>0?2:0)});return o.inherit(e,"base"),a&&(o.dataset.androidTarget=a.id,o.innerWrapped=e),o.exclude({resource:31}),o.positioned=!0,o.renderExclude=!1,o}}const T=new Toolbar("android.widget.toolbar",2);return squared&&squared.add(T),T}();
