this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";const e=squared.base.Application,t=android.base.Resource,{NODE_PROCEDURE:n,NODE_RESOURCE:a}=squared.base.lib.constant,{CONTAINER_NODE:r}=android.lib.constant,{createViewAttribute:i}=android.lib.util,{appendSeparator:o}=squared.base.lib.util,s={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^\d+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},d={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^\d+$/},c="menu",l="item",u="group",m=["showAsAction","actionViewClass","actionProviderClass"],h="ic_menu_";function p(e,t,n){const a=t.dataset;for(const t in a){const r=e[t];if(r){const e=a[t];if(e){const a=r.exec(e);if(a){const e=m.includes(t)?"app":"android";(n[e]||(n[e]={}))[t]=Array.from(new Set(a)).join("|")}}}}}function g(e,t){const n=t.title.trim();if(n)return n;for(const t of e.naturalChildren)if(t.textElement&&!t.textEmpty)return t.textContent.trim();return""}const f=(e,t)=>!!e.find((e=>e.toElementString("type")===t));class Menu extends squared.base.ExtensionUI{constructor(e,t,n){super(e,t,n),this.cascadeAll=!0,this.require({name:"android.external",leading:!0})}beforeInsertNode(e,t){if(this.included(e)&&e.childElementCount){if(new Set(Array.from(e.children).map((e=>e.tagName))).size>1)return!1;const n=this.application,a=n.getProcessing(t).rootElements;let r=e.parentElement;for(;r;){if("NAV"===r.tagName&&a.includes(r))return!1;r=r.parentElement}return n.addRootElement(t,e),!0}return!1}condition(e){return this.included(e.element)}processNode(t,n){const a=this.application.createNode(t.sessionId,{parent:n,flags:1,childIndex:t.childIndex});return a.actualParent=n.actualParent,t.documentRoot=!0,t.setControlType(c,11),t.addAlign(2),t.exclude({resource:31,procedure:63}),t.render(a),t.cascade((e=>this.addDescendant(e))),t.data(e.KEY_NAME,"pathname",o(this.application.userSettings.outputDirectory,"res/menu")),{outerParent:a,output:{type:1,node:t,controlName:c},complete:!0}}processChild(e,n){if(e.plainText)return e.hide(),{next:!0};const a=i(),r=a.android,o=e.localSettings.resourceId,m=e.element;let b,A;switch("NAV"===e.tagName?(b=c,A=g(e,m)):e.find((e=>!e.isEmpty()))?(e.find((e=>"NAV"===e.tagName))?b=l:(b=u,e.every((e=>f(e,"radio")))?r.checkableBehavior="single":e.every((e=>f(e,"checkbox")))&&(r.checkableBehavior="all")),A=g(e,m)):(b=l,A=(m.title||m.innerText).trim(),f(e,"checkbox")&&!n.android("checkableBehavior")&&(r.checkable="true")),b){case c:e.addAlign(2);break;case u:e.addAlign(2),p(d,m,a);break;case l:if(p(s,m,a),!r.icon){const t=this.resource;let n=t.addImageSrc(o,e.backgroundImage,h);if(n)r.icon=`@drawable/${n}`;else{const a=e.find((e=>e.imageElement));a&&(n=t.addImageSrc(o,a.element,h),n&&(r.icon=`@drawable/${n}`))}}e.each((e=>"NAV"!==e.tagName&&e.hide()))}return A&&(r.title=t.addString(o,A,"",this.application.extensionManager.valueAsBoolean("android.resource.strings","numberAsResource"))),e.setControlType(b,11),e.exclude({resource:31,procedure:63}),e.render(n),e.apply(a),{output:{type:1,node:e,controlName:b},complete:!0,next:b===c}}}const b=new Menu("android.widget.menu",2,{tagNames:["NAV"]});return squared&&squared.add(b),b}();
